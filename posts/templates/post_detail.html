{% extends 'base.html' %}

{% block content %}

<!-- if post is not approved yet -->
{% if post.status != 'Approved' %}

    <!-- if author or mod is viewing the unapproved post -->
    {% if post.author == user or user.userprofile.is_mod %}

        <!-- messages for author based on status of post -->
        {% if post.author == user and post.status == 'Waiting' %}
            <p>Thank you for submitting this post! It will be published after approval by a library moderator.</p>
        {% elif post.status == 'Deactivated' %}
            <p>This post has been deactivated by a library moderator</p>
        {% endif %}

        <!-- preview of post for author or mod -->
        <p>Post Preview:</p>

        <h1>{{ post.title }}</h1>

        {{ post.body|safe }}

        <p>Author username: {{ post.author }}</p>

        <p>Published: {{ post.created_on|date }}</p>

        {% if post.updated_on %}
        <p>Last updated: {{ post.updated_on }}</p>
        {% endif %}


        {% if post.author == user %}
        <!-- edit and delete buttons for author -->
        <button>Edit post</button>
        <button>Delete post</button>

            <!-- Message if mod is trying to approve own posts -->
            {% if post.author == user and user.userprofile.is_mod %}

            <p>You cannot approve your own posts</p>

            {% endif %}

        {% elif user.userprofile.is_mod %}
            <!-- buttons for moderator -->
            <a href="{% url 'approve_post' post.pk %}">Approve</a>
            <br>
            <button id="request-change">Request change</button>
            <button id="deactivate">Deactivate</button>
            <form method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <input type="submit" value="Send">
            </form>

        {% endif %}

    <!-- if non-author trying to view post not approved yet -->
    {% else %}
        <p>Post not found! This post may be awaiting approval from a library moderator.</p>
        <a href="{% url 'home' %}">Go back to home page</a>
    {% endif %}

<!-- If post has been approved -->
{% else %}
    <h1>{{ post.title }}</h1>

    {{ post.body|safe }}

    <p>Author username: {{ post.author }}</p>

    <p>Published: {{ post.created_on|date }}</p>

    {% if post.updated_on %}
        <p>Last updated: {{ post.updated_on }}</p>

        <!-- Show edit/delete buttons for author -->
        {% if post.author == user %}
            <button>Edit post</button>
            <button>Delete post</button>
        {% endif %}
    {% endif %}
{% endif %}



{% endblock %}