{% extends 'base.html' %}{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
{% endblock %}

{% block extra_title %}{{ post.title }}{% endblock %}

{% block extra_meta %}
<meta name="description" content="{{ post.summary }}">
<meta name="keywords" content="{{ post.category }}{% for tag in post.tags.all %}, {{ tag }}{% endfor %}">
<meta name="author" content="{{ author_name }}">
{% endblock %}

{% block content %}

<article id="post-detail" class="container mt-2 box-shadow-light-spread">
    <div class="row">
        <header id="post-detail-header" class="col-12">
            <h1 class="display-5 mb-3 mb-md-4 mb-lg-5">{{ post.title }}</h1>
            <div class="byline">
                <address class="author d-inline-block">Written by
                    {% if post.author.user.is_staff %}
                    <span class="ci-username-logo"></span>
                    {% endif %}
                    <a rel="author" href="{% url 'user_profile' post.author.pk %}">
                        {{ post.author.user.username }}
                    </a>
                </address>
                <!-- 
                    on small screens show author, published and updated dates
                    on their own lines. On larger screens show them all on one
                    line separated by a | 
                -->
                <span class="d-none d-lg-inline post-info-separator">|</span><br class="d-lg-none">
                Published: <time>{{ post.created_on|date }}</time>
                {% if post.updated_on %}
                <span class="d-none d-lg-inline post-info-separator">|</span><br class="d-lg-none">
                Updated: <time>{{ post.updated_on|date }}</time>
                {% endif %}
            </div>

            <div id="post-icons">
                <!-- bookmark icon shows solid if the logged in user has bookmarked the post -->
                <form action="{% url 'bookmark_post' post.pk %}" method="POST">
                    {% csrf_token %}
                    <button class="bookmark-btn post-icon" type="submit"
                        title="{% if bookmarked %}Remove this post from bookmarks{% else %}Bookmark this post{% endif %}">
                        {% if bookmarked %}
                        <i class="fas fa-bookmark"></i>
                        {% else %}
                        <i class="far fa-bookmark"></i>
                        {% endif %}
                    </button>
                </form>

                <!-- Like icon also shows hollow or solid depending on status -->
                <form action="{% url 'like_post' post.pk %}" method="POST">
                    {% csrf_token %}
                    <button class="like-btn post-icon" type="submit"
                        title="{% if liked %}Unlike this post{% else %}Like this post{% endif %}">
                        {% if liked %}
                        <i class="fas fa-thumbs-up"></i>
                        {% else %}
                        <i class="far fa-thumbs-up"></i>
                        {% endif %}
                    </button>
                    {% if total_likes > 99 %}
                    99+
                    {% else %}
                    {{ total_likes }}
                    {% endif %}
                </form>
            </div>
        </header>
        <div class="category-wrapper">
            <div class="category-line"></div>
            <a href="{% url 'category' post.category.pk post.category.name %}">
                <span class="category">{{ post.category }}</span>
            </a>
        </div>
        {% if post.editors_note %}
        <aside id="editors-note" class="col-12">
            <h2>Editors note</h2>
            <p>{{ post.editors_note }}</p>
        </aside>
        {% endif %}
        <section id="post-body" class="col-12 mt-4">
            {{ post.body|safe }}
        </section>
        {% if post.image_1 or post.image_2 or post.image_3 or post.image_4 %}
            <figure class="col-12">
                <div class="row justify-content-center">
                    {% if post.image_1 %}
                        <div class="col-6 col-md-3">
                            <a data-fancybox="gallery" href="{{ post.image_1.url }}">
                                <img class="post-image box-shadow-sharp" src="{{ post.image_1.url }}" alt="Image to accompany post">
                            </a>
                        </div>
                    {% endif %}

                    {% if post.image_2 %}
                        <div class="col-6 col-md-3">
                            <a data-fancybox="gallery" href="{{ post.image_2.url }}">
                                <img class="post-image box-shadow-sharp" src="{{ post.image_2.url }}" alt="Image to accompany post">
                            </a>
                        </div>
                    {% endif %}

                    {% if post.image_3 %}
                        <div class="col-6 col-md-3">
                            <a data-fancybox="gallery" href="{{ post.image_3.url }}">
                                <img class="post-image box-shadow-sharp" src="{{ post.image_3.url }}" alt="Image to accompany post">
                            </a>
                        </div>
                    {% endif %}

                    {% if post.image_4 %}
                        <div class="col-6 col-md-3">
                            <a data-fancybox="gallery" href="{{ post.image_4.url }}">
                                <img class="post-image box-shadow-sharp" src="{{ post.image_4.url }}" alt="Image to accompany post">
                            </a>
                        </div>
                    {% endif %}
                </div>
                <figcaption>Click on a thumbnail to enlarge</figcaption>
            </figure>
        {% endif %}
        <div id="bottom-post-btns" class="col-12">
            <form action="{% url 'like_post' post.pk %}" method="POST">
                {% csrf_token %}
                <button class="post-icon btn blue-btn-outline me-2 mb-2 mb-sm-auto"
                    type="submit">
                    {% if liked %}
                        <i class="fas fa-thumbs-up"></i>
                    {% else %}
                        <i class="far fa-thumbs-up"></i>
                    {% endif %}
                    <span>
                        {% if total_likes > 99 %}
                            99+
                        {% else %}
                            {{ total_likes }}
                        {% endif %}
                    </span>
                    <span>Like{% if liked %}d{% endif %}</span>
                </button>
            </form>
            
            <form action="{% url 'bookmark_post' post.pk %}" method="POST">
                {% csrf_token %}
                <button class="post-icon btn blue-btn-outline me-2 mb-2 mb-sm-auto"
                    type="submit">
                    {% if bookmarked %}
                        <i class="fas fa-bookmark"></i>
                    {% else %}
                        <i class="far fa-bookmark"></i>
                    {% endif %}
                    <span>Bookmark{% if bookmarked %}ed{% endif %}</span>
                </button>
            </form>

            <button id="flag" type="button" data-bs-toggle="modal" data-bs-target="#flagModal"
                class="post-icon btn blue-btn-outline me-2 mb-2 mb-sm-auto"
                title="Flag this post">
                <i class="far fa-flag"></i>
            </button>
            <!-- Modal -->
            <div class="modal fade" id="flagModal" tabindex="-1" aria-labelledby="flagModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="flagModalLabel">Modal title</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="{% url 'post_detail' post.pk post.slug %}" method="POST" class="form">
                                {% csrf_token %}
                                {{ form }}
                                <div class="modal-line"></div>
                                <button type="submit">Send</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</article>

<p>Tags: {% for tag in post.tags.all %}{{ tag }} {% endfor %}</p>

<!-- Show edit/delete buttons for author -->
{% if post.author.user == user %}
<a href="{% url 'edit_post' post.pk post.slug %}">Edit post</a>
<button class="deleteBtn" data-post-pk="{{ post.pk }}">Delete post</button>
{% endif %}

{% endblock %}

{% block extra_js %}
<!-- jQuery for fancybox -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>

<!-- fancybox to create lightbox for images -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

<!-- custom script for delete button check -->
<script src="{% static 'js/postBtns.js' %}"></script>
{% endblock %}