{% extends 'base.html' %}{% load static %}

{% block extra_css %}
    <!-- css for fancybox -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
{% endblock %}

{% block content %}

    {% if post.status == 'Waiting' %}
        <p>Thank you for submitting this post! It will be published after approval by a library moderator.</p>
    {% elif post.status == 'Review' %}
        <p>This post has been reviewed by {{post.moderator}}. They have requested the following change(s):</p>
        <p>{{post.mod_message}}</p>
    {% endif %}

    <h1>{{ post.title }}</h1>
    
    <p>Author username: <a href="{% url 'user_profile' post.author.pk %}">{{ post.author.user.username }}</a> | Published: {{ post.created_on|date }}</p>
    <p>Author kudos badge: {{ post.author.kudos_badge }}</p>   
    {% if post.updated_on %}
        <p>Last updated: {{ post.updated_on }}</p>
    {% endif %} 

    <p>Category: <a href="{% url 'category' post.category.id post.category|slugify %}">{{ post.category }}</a></p>

    <p>Tags: {% for tag in post.tags.all %}{{ tag }} {% endfor %}</p>

    {{ post.body|safe }}

    {% if post.image_1 %}
        <a data-fancybox="gallery" href="{{ post.image_1.url }}">
            <img class="post-image" src="{{ post.image_1.url }}" alt="Image to accompany post">
        </a>
    {% endif %}

    {% if post.image_2 %}
    <a data-fancybox="gallery" href="{{ post.image_2.url }}">
        <img class="post-image" src="{{ post.image_2.url }}" alt="Image to accompany post">
    </a>
    {% endif %}

    {% if post.image_3 %}
        <a data-fancybox="gallery" href="{{ post.image_3.url }}">
            <img class="post-image" src="{{ post.image_3.url }}" alt="Image to accompany post">
        </a>
    {% endif %}

    {% if post.image_4 %}
        <a data-fancybox="gallery" href="{{ post.image_4.url }}">
            <img class="post-image" src="{{ post.image_4.url }}" alt="Image to accompany post">
        </a>
    {% endif %}    

    {% if post.author == user.userprofile %}
    <!-- edit and delete buttons for author -->
    <a href="{% url 'edit_post' post.pk post.slug %}">Edit post</a>
    <button class="deleteBtn" data-post-pk="{{ post.pk }}">Delete post</button>

        <!-- Message if mod is trying to approve own posts -->
        {% if post.author == user.userprofile.author and user.userprofile.is_mod %}

        <p>You cannot approve your own posts</p>

        {% endif %}

    {% else %}
        <!-- buttons for moderator -->
        <a href="{% url 'approve_post' post.pk post.slug %}">Approve</a>
        <br>
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <input type="submit" value="Request Change">
        </form>
        <a href="{% url 'review_posts' %}">Back to reviews page</a>

    {% endif %}


{% endblock %}

{% block extra_js %}
    <!-- jQuery for fancybox -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
    
    <!-- fancybox to create lightbox for images -->
    <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

    <!-- custom script for delete button check -->
    <script src="{% static 'js/postBtns.js' %}"></script>
{% endblock %}